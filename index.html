<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <script
      src="https://kit.fontawesome.com/703a1e3528.js"
      crossorigin="anonymous"
    ></script>
    <title>Music Player</title>
  </head>
  <body>
    <div class="container">
      <div id="drop-area">
        <div class="music-player">
          <nav>
            <div class="circle"><i class="fa-solid fa-angle-left"></i></div>
            <div class="circle"><i class="fa-solid fa-bars"></i></div>
          </nav>
          <img src="media/thumbnail.jpg" alt="thumbnail" class="song-img" />
          <h1 id="title">Drag And Drop a song from media folder</h1>
          <p id="songName"></p>

          <audio id="song">
            <source id="source" src="" type="audio/mpeg" />
            <!-- <source id="source" type="audio/mpeg" /> -->
          </audio>
          <input type="range" value="0" / id="progress">

          <div class="controls">
            <div><i class="fa-solid fa-backward"></i></div>
            <div onclick="playPause()">
              <i class="fa-solid fa-play" id="ctrlIcon"></i>
            </div>
            <div><i class="fa-solid fa-forward"></i></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let progress = document.getElementById("progress");
      let song = document.getElementById("song");
      let ctrlIcon = document.getElementById("ctrlIcon");
      let songSource = document.getElementById("source");
      let title = document.getElementById("title");
      let songName = document.getElementById("songName");
      let dropArea = document.getElementById("drop-area");
      let noSong = false;

      console.log(noSong);

      dropArea.addEventListener("dragover", (event) => {
        event.stopPropagation();
        event.preventDefault();
        event.dataTransfer.dropEffect = "copy";
      });

      dropArea.addEventListener("drop", (event) => {
        event.stopPropagation();
        event.preventDefault();

        let fileList = event.dataTransfer.files;
        console.log(fileList[0].name);
        title.innerHTML = fileList[0].name.split("-")[0];
        songName.innerHTML = fileList[0].name.split("-", 2)[1];
        songSource.src = `media/${fileList[0].name}`;
        // console.log(songSource);
        song.load();
        noSong = true;
        if (ctrlIcon.classList.contains("fa-pause")) {
          ctrlIcon.classList.remove("fa-pause");
          ctrlIcon.classList.add("fa-play");
          playPause();
        }
      });

      song.onloadedmetadata = function () {
        progress.max = song.duration;
        progress.value = song.currentTime;
      };

      function playPause() {
        if (!noSong) return;
        else {
          if (ctrlIcon.classList.contains("fa-pause")) {
            song.pause();
            ctrlIcon.classList.remove("fa-pause");
            ctrlIcon.classList.add("fa-play");
          } else {
            song.play();
            ctrlIcon.classList.add("fa-pause");
            ctrlIcon.classList.remove("fa-play");
          }
        }
      }
      if (song.play()) {
        setInterval(() => {
          progress.value = song.currentTime;
        }, 500);

        progress.onchange = function () {
          song.play();
          song.currentTime = progress.value;
          ctrlIcon.classList.add("fa-pause");
          ctrlIcon.classList.remove("fa-play");
        };
      }
    </script>
  </body>
</html>
